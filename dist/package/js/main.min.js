var plateLayOutWidget=plateLayOutWidget||{};!function(u,e){plateLayOutWidget.addDataOnChange=function(){return{_addAllData:function(e){if(this.allSelectedObjects)for(var t=this.allSelectedObjects.length,i=[],a=0;a<t;a++){var n,l=this.allSelectedObjects[a];l.index in this.engine.derivative?n=this.engine.derivative[l.index]:(n=u.extend(!0,{},this.defaultWell),this.engine.derivative[l.index]=n);var s=this.processWellData(e,n,t,i);if(i=s.wells,n=s.well,this.engine.wellEmpty(n))if(this.emptyWellWithDefaultVal&&this.disableAddDeleteWell){var r=JSON.parse(JSON.stringify(n)),o=this.emptyWellWithDefaultVal;for(var d in o)d in r&&(r[d]=o[d],this._applyFieldData(d,o[d]));this.engine.derivative[l.index]=r}else delete this.engine.derivative[l.index]}this._getAllMultipleVal(i),this.applyFieldWarning(i),this._colorMixer(),this.derivativeChange()},processWellData:function(e,t,i,a){for(var n in a||(a=[]),e){var l;if(void 0!==e[n]&&null!==e[n])if(e[n].multi){var s=e[n],r=t[n],o=this._getMultiData(r,s,n,i);l=JSON.parse(JSON.stringify(o))}else l=JSON.parse(JSON.stringify(e[n]));else l=JSON.parse(JSON.stringify(e[n]));t[n]=l,a.push(t)}return{well:t,wells:a}},_getMultiData:function(e,t,i,a){var n=t.added,l=t.removed;if(n)if(e)if(n.value){var s=!0;for(var r in e){e[r][i].toString()===n.id.toString()&&(s=!1,e=e.map(function(e){if(e[i].toString()===n.id.toString())for(var t in e)t in n.value&&t!==i&&(1===a?e[t]=n.value[t]:n.value[t]&&(e[t]=n.value[t]));return e}))}s&&e.push(n.value)}else e.indexOf(n)<0&&e.push(n);else e=[],n.value?e.push(n.value):n&&e.push(n);var o,d=function(e,t){var i=[];for(var a in e)parseInt(a)!==parseInt(t)&&i.push(e[a]);return i};if(l)if(l.value){for(var r in e){e[r][i].toString()===l.id.toString()&&(o=r)}e=d(e,o)}else e&&0<=(o=e.indexOf(l))&&(e=d(e,o));return e&&0==e.length&&(e=null),e},_colorMixer:function(){if(!this.undoRedoActive){var e=this.createObject();this.addToUndoRedo(e)}this.engine.searchAndStack(),this.engine.applyColors(),this.mainFabricCanvas.renderAll()},derivativeChange:function(){this._trigger("updateWells",null,this.createObject())},createObject:function(){return{derivative:u.extend(!0,{},this.engine.derivative),checkboxes:this.globalSelectedAttributes.slice(),selectedAreas:this.selectedAreas.slice(),focalWell:this.focalWell,requiredField:this.requiredField}}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};jQuery,fabric,plateLayOutWidget.addDataToFields=function(){return{_addDataToTabFields:function(e){for(var t in e)this._applyFieldData(t,e[t])},_applyFieldData:function(e,t){this.fieldMap[e].setValue(t)}}};plateLayOutWidget=plateLayOutWidget||{};!function(u,e){plateLayOutWidget.addTabData=function(){return{fieldList:[],fieldMap:{},autoId:1,_addTabData:function(){var e=this.options.attributes.tabs,r=this;this.requiredField=[];var o=[];e.forEach(function(e,t){if(e.fields){var i=e.fields,a=[];for(var n in i){var l,s=i[n];s.id||(s.id="Auto"+r.autoId++,console.log("Field autoassigned id "+s.id)),s.type||(s.type="text",console.log("Field "+s.id+" autoassigned type "+s.type)),"multiplex"===s.type?(l=r._makeMultiplexField(s,t,a),o.push(l)):(l=r._makeRegularField(s,t,a,!0),"multiselect"===s.type&&o.push(l))}r.allDataTabs[t].fields=a}else console.log("unknown format in field initialization")}),r.multipleFieldList=o},_makeSubField:function(e,t,i){var a=this;e.id||(e.id="Auto"+a.autoId++,console.log("Field autoassigned id "+e.id)),e.type||(e.type="text",console.log("Field "+e.id+" autoassigned type "+e.type));var n=a._createElement("<div></div>").addClass("plate-setup-tab-default-field"),l=a._createElement("<div></div>").addClass("plate-setup-tab-field-left-side"),s=a._createElement("<div></div>").addClass("plate-setup-tab-field-right-side"),r=a._createElement("<div></div>").addClass("plate-setup-tab-name").text(e.name),o=a._createElement("<div></div>").addClass("plate-setup-tab-field-container");u(s).append(r),u(s).append(o),u(n).append(l),u(n).append(s),u(a.allDataTabs[t]).append(n);var d={id:e.id,name:e.name,root:n,data:e,required:e.required||!1};return i.push(d),a.fieldMap[e.id]=d},_makeRegularField:function(e,t,i,a){var n=this,l=n._createElement("<div></div>").addClass("plate-setup-tab-default-field"),s=n._createElement("<div></div>").addClass("plate-setup-tab-field-left-side"),r=n._createElement("<div></div>").addClass("plate-setup-tab-field-right-side "),o=n._createElement("<div></div>").addClass("plate-setup-tab-name").text(e.name),d=n._createElement("<div></div>").addClass("plate-setup-tab-field-container");r.append(o),r.append(d),l.append(s),l.append(r),n.allDataTabs[t].append(l);var u={id:e.id,name:e.name,root:l,data:e,required:e.required};return u.required&&n.requiredField.push(u.id),i.push(u),n.fieldList.push(u),n.fieldMap[u.id]=u,a&&n._addCheckBox(u),n._createField(u),u.onChange=function(){var e=u.getValue(),t={};t[u.id]=e,n._addAllData(t)},u},_makeMultiplexField:function(e,t,i){var a=this,n=a._createElement("<div></div>").addClass("plate-setup-tab-default-field"),l=a._createElement("<div></div>").addClass("plate-setup-tab-field-left-side"),s=a._createElement("<div></div>").addClass("plate-setup-tab-field-right-side "),r=a._createElement("<div></div>").addClass("plate-setup-tab-name").text(e.name),o=a._createElement("<div></div>").addClass("plate-setup-tab-field-container");s.append(r),s.append(o),n.append(l),n.append(s),a.allDataTabs[t].append(n);var d={id:e.id,name:e.name,root:n,data:e,required:e.required};i.push(d),a.fieldList.push(d),a.fieldMap[e.id]=d;var u=[],c=[];for(var f in e.multiplexFields){var p=e.multiplexFields[f],h=a._makeSubField(p,t,i);u.push(h),p.required&&c.push(h.id)}return(d.required||c.length)&&this.requiredField.push({multiplexId:d.id,subFields:c}),d.subFieldList=u,a._createField(d),a._addCheckBox(d),u.forEach(function(s){s.mainMultiplexField=d,i.push(s),a._createField(s),a._addCheckBox(s),delete a.defaultWell[s.id],s.onChange=function(){var t=s.getValue(),i=s.mainMultiplexField,a=i.singleSelectValue(),e={};e[i.id]=a,e[s.id]=t;var n={id:a,value:e};d._changeMultiFieldValue(n,null);var l=i.detailData;null!==l&&(a=i.singleSelectValue(),l=l.map(function(e){return e[i.id]===a&&(e[s.id]=t),e})),i.detailData=l}}),d.getValue=function(){var e=d.input.select2("data");return e.length?e.map(function(e){return e.id}):null},d}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};!function(s,e){plateLayOutWidget.addWarningMsg=function(){return{fieldWarningMsg:function(e,t,i){var a="fieldWarning"+e.id,n=s("<span>").html(this._assets.warningImg).attr("id",a).addClass("plate-field-warning-image");if(i){if(e.root.find("#"+a).length<=0){e.root.find(".plate-setup-tab-name").text(" "+e.name),e.root.find(".plate-setup-tab-name").prepend(n);var l=s("<div/>").addClass("pop-out-text");l.text(t),e.root.find(".plate-setup-tab-name").append(l),s("#"+a).hover(function(e){l[0].style.display="flex"},function(){l.hide()})}}else 0<e.root.find("#"+a).length&&(e.root.find(".plate-setup-tab-name").text(e.name),s("#"+a).remove())},removeWarningMsg:function(e,t,i){var a="fieldWarning"+e.id,n=s("<span>").html(this._assets.warningImg).attr("id",a).addClass("plate-field-warning-image");if(i){e.root.find(".plate-setup-tab-name").append(n);var l=s("<div/>").addClass("pop-out-text");l.text(t),e.root.find(".plate-setup-tab-name").append(l),s("#"+a).hover(function(e){l[0].style.display="inline-block"},function(){l.hide()})}else s("#"+a).remove(),0<e.root.find("#"+a).length&&s("#"+a).remove()},applyFieldWarning:function(e){var i=this,a={};i.fieldList.forEach(function(e){a[e.id]=[]}),e.forEach(function(e){if(!i.engine.wellEmpty(e))for(var t in a)t in e?a[t].push(e[t]):a[t].push(null)});for(var t=0;t<i.fieldList.length;t++){var n=i.fieldList[t];if(n.applyMultiplexSubFieldColor)n.applyMultiplexSubFieldColor(a[n.id]);else if(n.required){var l=!1;a[n.id].forEach(function(e){e instanceof Array?0===e.length&&(l=!0):null===e&&(l=!0)}),i.fieldWarningMsg(n,"required field",l)}}}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};!function(d,e){plateLayOutWidget.bottomTable=function(){return{_bottomScreen:function(){this.bottomContainer=this._createElement("<div></div>").addClass("plate-setup-bottom-container"),this.bottomTableContainer=this._createElement("<div></div>").addClass("plate-setup-bottom-table-container"),this.bottomTable=this._createElement("<table></table>").addClass("plate-setup-bottom-table"),this.bottomTableContainer.append(this.bottomTable),this.bottomContainer.append(this.bottomTableContainer),this.container.append(this.bottomContainer)},addBottomTableHeadings:function(){this.bottomRow=this._createElement("<tr></tr>");var e=this._createElement("<th></th>").text("Group");this.bottomRow.prepend(e),this.bottomTable.empty(),this.bottomTable.append(this.bottomRow),this.rowCounter=1;for(var t=0;t<this.globalSelectedAttributes.length;t++){var i=this.globalSelectedAttributes[t],a=this.fieldMap[i];e=this._createElement("<th></th>").text(a.name);this.bottomRow.append(e),this.rowCounter=this.rowCounter+1}this.adjustFieldWidth(this.bottomRow)},tileAttrText:function(e,t){var i=this.engine.derivative[e.index];return this.fieldMap[t].getText(i[t])},addBottomTableRow:function(e,i){var a=this,t=this.allTiles[i[0]],n=this._createElement("<tr></tr>"),l=this._createElement("<td></td>").addClass("plate-setup-bottom-id"),s=this._createElement("<button/>");s.addClass("plate-setup-color-text"),s.text(e),l.append(s),s.click(function(e){var t=i.map(function(e){return a.indexToAddress(e)});e.ctrlKey&&a.getSelectedAddress().forEach(function(e){t.indexOf(e)<0&&t.push(e)}),a.setSelectedWell(t),a._trigger("selectedWells",null,{selectedAddress:a.getSelectedAddress()})}),0<e&&(e=(e-1)%(this.colorPairs.length-1)+1);var r=this.colorPairs[e];l.css("background","linear-gradient(to right, "+r[0]+" , "+r[1]+")"),n.append(l);for(var o=0;o<this.globalSelectedAttributes.length;o++){var d=this.globalSelectedAttributes[o],u=this.tileAttrText(t,d),c=this._createElement("<td></td>").text(u);n.append(c)}this.bottomTable.append(n),this.adjustFieldWidth(n)},bottomForFirstTime:function(){this.addBottomTableHeadings();var e=this._createElement("<tr></tr>"),t=this.colorPairs[0],i=this._createElement("<td></td>");i.css("background","-webkit-linear-gradient(left, "+t[0]+" , "+t[1]+")"),e.append(i),this.bottomTable.append(e),this.createExportButton()},adjustFieldWidth:function(e){var t=this.rowCounter;1024<150*t&&e.css("width",152*t+"px")},downloadCSV:function(e,t){var i,a;i=new Blob([e],{type:"text/csv"}),(a=document.createElement("a")).download=t,a.href=window.URL.createObjectURL(i),a.style.display="none",document.body.appendChild(a),a.click()},exportData:function(e){var t=[],i=document.querySelectorAll("table tr"),a={},n=this.engine.stackUpWithColor,l=this.getDimensions(),s=this;for(var r in n)a[r]=n[r].map(function(e){return s.indexToAddress(e,l)});for(var o=0;o<i.length;o++){for(var d=[],u=i[o].querySelectorAll("td, th"),c=0;c<u.length;c++){var f="";if(u[c].innerText&&(f="csv"===e?'"'+u[c].innerText.replace(/"/g,'""')+'"':u[c].innerText),d.push(f),0===o&&0===c&&("csv"===e?d.push('"Location"'):"clipboard"===e&&d.push("Location")),0!==o&&0===c){var p="";a[parseInt(u[c].innerText)]&&("csv"===e?p='"'+a[parseInt(u[c].innerText)].join(",")+'"':"clipboard"===e&&(p=a[parseInt(u[c].innerText)].join(","))),d.push(p)}}"csv"===e?t.push(d.join(",")):"clipboard"===e&&t.push(d.join("\t"))}if("csv"===e)this.downloadCSV(t.join("\n"),"table.csv");else if("clipboard"===e)return t.join("\n")},createExportButton:function(){var e=this,t=d("<div>").addClass("plate-setup-bottom-control-container"),i=d("<div>").addClass("plate-setup-overlay-text-container");i.text("Color groups"),t.append(i);var a=d("<div>").addClass("plate-setup-overlay-bottom-button-container"),n=d("<button/>").addClass("plate-setup-button");function l(){n.text("Export CSV"),n[0].classList.remove("plate-setup-clicked-button"),n.addClass("plate-setup-button")}n.text("Export CSV"),a.append(n),n.click(function(){e.exportData("csv"),n.text("Exported"),n[0].classList.remove("plate-setup-button"),n.addClass("plate-setup-clicked-button"),setTimeout(l,3e3)});var s=d("<button/>").addClass("plate-setup-button");s.text("Copy To Clipboard"),a.append(s);var r=new Clipboard(s.get(0),{text:function(){return e.exportData("clipboard")}});function o(){s.text("Copy To Clipboard"),s[0].classList.remove("plate-setup-clicked-button"),s.addClass("plate-setup-button")}r.on("success",function(e){s.text("Copied as tab-delimited format"),s[0].classList.remove("plate-setup-button"),s.addClass("plate-setup-clicked-button"),setTimeout(o,3e3)}),r.on("error",function(e){s.text("Failed to copy table to clipboard: browser may be incompatible"),setTimeout(o,3e3)}),t.append(a),d(".plate-setup-bottom-container").prepend(t)}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};!function(e,i){plateLayOutWidget.canvas=function(){return{allSelectedObjects:null,allPreviouslySelectedObjects:null,colorPointer:0,goldenRatio:.618033988749895,_createCanvas:function(){this.normalCanvas=this._createElement("<canvas>").attr("id","DNAcanvas"),e(this.canvasContainer).append(this.normalCanvas)},_initiateFabricCanvas:function(){var e=this.canvasContainer.width(),t=this.canvasContainer.height();this._setCanvasArea(e,t),this.mainFabricCanvas=new i.Canvas("DNAcanvas",{backgroundColor:"#f5f5f5",selection:!0,stateful:!1,hoverCursor:"pointer",renderOnAddRemove:!1}).setWidth(e).setHeight(t)}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};!function(l,e){plateLayOutWidget.checkBox=function(){return{globalSelectedAttributes:[],_addCheckBox:function(e){var t=l("<span>").html(this._assets.dontImg).addClass("plate-setup-tab-check-box bg-light").data("clicked",!1);t.data("linkedFieldId",e.id),e.root.find(".plate-setup-tab-field-left-side").empty().append(t),this._applyCheckboxHandler(t),e.checkbox=t},_applyCheckboxHandler:function(e){var n=this;e.click(function(e,t){var i=l(this),a={};a[i.data("linkedFieldId")]=!i.data("clicked"),n.changeCheckboxes(a)})},changeSubFieldsCheckboxes:function(e,n){var l=this,s=[];return e.subFieldList.forEach(function(e){var t=e.checkbox,i=t.data("linkedFieldId"),a=t.data("clicked");i in n&&(a=Boolean(n[i])),t.data("clicked",a),a?(t.html(l._assets.doImg),s.push(e.id)):t.html(l._assets.dontImg)}),s},changeCheckboxes:function(e){for(var t=[],i={},a=0;a<this.fieldList.length;a++){var n=this.fieldList[a];if(n.checkbox){n.subFieldList&&(i[n.id]=this.changeSubFieldsCheckboxes(n,e));var l=n.checkbox,s=l.data("linkedFieldId"),r=l.data("clicked");s in e&&(r=Boolean(e[s])),l.data("clicked",r),r?(t.push(s),l.html(this._assets.doImg)):l.html(this._assets.dontImg)}}this.globalSelectedMultiplexSubfield=i,this.globalSelectedAttributes=t,this._clearPresetSelection(),this._colorMixer()},setSubFieldCheckboxes:function(e,n){var l=this,s=[];return e.subFieldList.forEach(function(e){var t=e.checkbox,i=t.data("linkedFieldId"),a=0<=n.indexOf(i);t.data("clicked",a),a?(t.html(l._assets.doImg),s.push(e.id)):t.html(l._assets.dontImg)}),s},setCheckboxes:function(e){e=e||[];for(var t=[],i={},a=0;a<this.fieldList.length;a++){var n=this.fieldList[a];if(n.checkbox){n.subFieldList&&(i[n.id]=this.setSubFieldCheckboxes(n,e));var l=n.checkbox,s=l.data("linkedFieldId"),r=0<=e.indexOf(s);l.data("clicked",r),r?(t.push(s),l.html(this._assets.doImg)):l.html(this._assets.dontImg)}}this.globalSelectedMultiplexSubfield=i,this.globalSelectedAttributes=t,this._clearPresetSelection(),this._colorMixer()}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};jQuery,fabric,plateLayOutWidget.colorManager=function(){return{colorPairs:[["#e6e6e6","#808080"],["#66e8ff","#0082c8"],["#ff7fb1","#e6194b"],["#a2ffb1","#3cb44b"],["#f784ff","#911eb4"],["#ffe897","#f58231"],["#6666ff","#0000FF"],["#ffff7f","#ffe119"],["#acffff","#46f0f0"],["#ff98ff","#f032e6"],["#ffffa2","#d2f53c"],["#ffffff","#fabebe"],["#66e6e6","#008080"],["#ffffff","#e6beff"],["#ffd48e","#aa6e28"],["#e66666","#800000"],["#ffffff","#aaffc3"],["#e6e666","#808000"],["#ffffff","#ffd8b1"],["#66a9ef","#004389"],["#ff6672","#a7000c"],["#66db72","#00750c"],["#b866db","#520075"],["#ffa966","#b64300"],["#ffff66","#c0a200"],["#6dffff","#07b1b1"],["#ff66ff","#b100a7"],["#f9ff66","#93b600"],["#ffe5e5","#bb7f7f"],["#66a7a7","#004141"],["#ffe5ff","#a77fc0"],["#d19566","#6b2f00"],["#ffffef","#c0bb89"],["#d1ffea","#6bc084"],["#a7a766","#414100"],["#ffffd8","#c09972"],["#a5ffff","#3fc1ff"],["#ffbef0","#ff588a"],["#e1fff0","#7bf38a"],["#ffc3ff","#d05df3"],["#ffffd6","#ffc170"],["#a5a5ff","#3f3fff"],["#ffffbe","#ffff58"],["#ebffff","#85ffff"],["#ffd7ff","#ff71ff"],["#a5ffff","#3fbfbf"],["#ffffcd","#e9ad67"],["#ffa5a5","#bf3f3f"],["#ffffa5","#bfbf3f"]]}};plateLayOutWidget=plateLayOutWidget||{};!function(e,u){plateLayOutWidget.createCanvasElements=function(){return{scaleFactor:1,baseSizes:{spacing:48,tile_radius:22,center_radius_complete:10,center_radius_incomplete:14,label_size:14,label_spacing:24,text_size:13,stroke:.5,gap:2},_setCanvasArea:function(e,t){this.scaleFactor=Math.min(t/(this.dimensions.rows*this.baseSizes.spacing+this.baseSizes.label_spacing),e/(this.dimensions.cols*this.baseSizes.spacing+this.baseSizes.label_spacing));var i={};for(var a in this.baseSizes)i[a]=this.baseSizes[a]*this.scaleFactor;this.sizes=i},_canvas:function(){this._fixRowAndColumn(),this._putCircles()},_fixRowAndColumn:function(){for(var e=this.dimensions.cols,t=this.dimensions.rows,i=this.sizes.spacing,a=this.sizes.label_spacing/2,n=this.sizes.label_spacing+this.sizes.spacing/2,l=this.sizes.label_size,s=a,r=n,o=1;o<=e;o++){var d=new u.IText(o.toString(),{fill:"black",originX:"center",originY:"center",fontSize:l,top:s,left:r,fontFamily:'"Roboto", Arial, sans-serif',selectable:!1,fontWeight:"400"});r+=i,this.mainFabricCanvas.add(d)}s=n,r=a;for(o=1;o<=t;o++){d=new u.IText(this.rowIndex[o-1],{fill:"black",originX:"center",originY:"center",fontSize:l,top:s,left:r,fontFamily:'"Roboto", Arial, sans-serif',selectable:!1,fontWeight:"400"});s+=i,this.mainFabricCanvas.add(d)}},_putCircles:function(){for(var e=this.dimensions.cols,t=this.dimensions.rows,i=0,a=0;a<t;a++)for(var n=0;n<e;n++){this.allTiles.length;var l=this._createTile(a,n);l.index=i++,this.allTiles.push(l),this.mainFabricCanvas.add(l.background),this.mainFabricCanvas.add(l.highlight),this.mainFabricCanvas.add(l.circle),this.mainFabricCanvas.add(l.circleCenter),this.mainFabricCanvas.add(l.circleText)}this._addLargeRectangleOverlay(),this._fabricEvents()},_createTile:function(e,t){var i={visible:!1,colorIndex:null};i.row=e,i.col=t,i.address=this.rowIndex[e]+(t+1);var a=(e+1)*this.sizes.spacing,n=(t+1)*this.sizes.spacing;return i.background=new u.Circle({top:a,left:n,radius:this.sizes.tile_radius,originX:"center",originY:"center",hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,evented:!1}),i.background.setGradient("fill",{type:"radial",y1:this.sizes.gap,y2:this.sizes.gap,r1:this.sizes.tile_radius-this.sizes.gap,r2:this.sizes.tile_radius,colorStops:{0:"rgba(0,0,0,0.1)",1:"rgba(0,0,0,0.2)"}}),i.highlight=new u.Rect({originX:"center",originY:"center",top:a,left:n,width:this.sizes.spacing,height:this.sizes.spacing,fill:"rgba(0,0,0,0.4)",evented:!1,visible:!1}),i.circle=new u.Circle({originX:"center",originY:"center",top:a,left:n,radius:this.sizes.tile_radius,stroke:"gray",strokeWidth:this.sizes.stroke,evented:!1,visible:!1}),i.circleCenter=new u.Circle({originX:"center",originY:"center",top:a,left:n,radius:this.sizes.center_radius_incomplete,fill:"white",stroke:"gray",strokeWidth:this.sizes.stroke,evented:!1,visible:!1}),i.circleText=new u.IText("",{originX:"center",originY:"center",top:a,left:n,fill:"black",fontFamily:'"Roboto", Arial, sans-serif',fontSize:this.sizes.text_size,lockScalingX:!0,lockScalingY:!0,evented:!1,visible:!1}),i},setTileComplete:function(e,t){e.circleText.fontWeight=t?(e.circleCenter.radius=this.sizes.center_radius_complete,e.circleText.fill="black","normal"):(e.circleCenter.radius=this.sizes.center_radius_incomplete,e.circleText.fill="red","bold")},setTileVisible:function(e,t){e.visible=t,e.circle.visible=e.visible,e.circleCenter.visible=e.visible,e.circleText.visible=e.visible},setTileColor:function(e,t,i){this.setTileVisible(e,!0),e.colorIndex=parseInt(t),e.circleText.text=String(e.colorIndex),0<t&&(t=(t-1)%(this.colorPairs.length-1)+1);var a=this.colorPairs[t];e.circle.setGradient("fill",{x1:0,y1:-this.sizes.tile_radius,x2:0,y2:this.sizes.tile_radius,colorStops:a})},_addLargeRectangleOverlay:function(){this.overLay=new u.Rect({width:632,height:482,left:0,top:0,opacity:0,originX:"left",originY:"top",lockMovementY:!0,lockMovementX:!0,selectable:!1}),this.mainFabricCanvas.add(this.overLay)}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};!function(f,e){plateLayOutWidget.createField=function(){return{_createField:function(e){switch(e.data.type){case"text":this._createTextField(e);break;case"numeric":this._createNumericField(e);break;case"select":this._createSelectField(e);break;case"multiselect":this._createMultiSelectField(e);break;case"boolean":this._createBooleanField(e);break;case"multiplex":this._createMultiplexField(e)}},_createTextField:function(i){var e=i.id,t=this._createElement("<input>").attr("id",e).addClass("plate-setup-tab-input");i.root.find(".plate-setup-tab-field-container").append(t),this.defaultWell[e]=null,i.parseValue=function(e){return e=e?String(e):null},i.getValue=function(){var e=t.val().trim();return""==e&&(e=null),e},i.setValue=function(e){t.val(e)},i.getText=function(e){return null==e?"":e},i.disabled=function(e){i.input.prop("disabled",e)},i.parseText=i.parseValue,t.on("input",function(e,t){i.onChange()}),i.input=t},_createOpts:function(e){var t={allowClear:!0,placeholder:"select",minimumResultsForSearch:10};if(e.options)t.data=e.options;else{if(!e.query)throw"Must specify data or query";var i=e.query;e.delay&&(i=this._debounce(e.delay,i)),t.query=i}return t},_createSelectField:function(i){var a=i.id,t=this._createElement("<input/>").attr("id",a).addClass("plate-setup-tab-select-field");i.root.find(".plate-setup-tab-field-container").append(t),this.defaultWell[a]=null;var n=this._createOpts(i.data),l={};n.data.forEach(function(e){l[e.id]=e}),t.select2(n),i.parseValue=function(e){var t=e;if(""==t&&(t=null),null==t)return null;if(t in l)return l[t].id;throw"Invalid value "+e+" for select field "+a},i.disabled=function(e){i.input.prop("disabled",e)},i.getValue=function(){var e=t.select2("data");return e?e.id:null},i.setValue=function(e){e&&(e=l[e]),t.select2("data",e)},i.setOpts=function(e){t.select2("data",{}),n.data=e||[],t.select2(n)},i.getText=function(e){return null==e?"":l[e].text},i.parseText=function(e){var t=e;if(""==t&&(t=null),null==t)return null;if(t in l)return l[t].text;throw"Invalid text value "+e+" for select field "+a},t.on("change",function(e,t){i.onChange()}),i.input=t},_createMultiSelectField:function(l){var i=l.id,a=this,s=this._createElement("<input/>").attr("id",i).addClass("plate-setup-tab-multiselect-field");s.attr("multiple","multiple"),l.root.find(".plate-setup-tab-field-container").append(s),a.defaultWell[i]=null;var r=a._createOpts(l.data);r.multiple=!0;var n={};r.data.forEach(function(e){n[e.id]=e}),s.select2(r),l.disabled=function(e){l.input.prop("disabled",e)},l.parseValue=function(e){var t=e;return t=t&&t.length?t.map(function(e){if(e in n)return n[e].id;throw"Invalid value "+e+" for multiselect field "+i}):null},l.setOpts=function(e){var t=l.data.options,i=[];for(var a in t){var n=t[a];0<=e.indexOf(n.id)&&i.push(n)}r.data=i,s.select2(r)},l.getValue=function(){var e=s.select2("data");return e.length?e.map(function(e){return e.id}):null},l.setValue=function(e){e=(e=e||[]).map(function(e){return n[e]}),s.select2("data",e)},l.getText=function(e){return null==e?"":0<e.length?e.map(function(e){return n[e].text}).join("; "):""},l.multiOnChange=function(e,t){e&&(e=e.id.toString()),t&&(t=t.id.toString());var i={};i[l.id]={multi:!0,added:e,removed:t},a._addAllData(i)},l.parseText=function(e){var t=e;return t=t&&t.length?t.map(function(e){if(e in n)return n[e].text;throw"Invalid text value "+e+" for multiselect field "+i}):null},s.on("change",function(e,t){var i=e.added,a=e.removed;l.multiOnChange(i,a)}),l.input=s,a._createDeleteButton(l)},_createNumericField:function(n){var i=n.id,e=n.data,t=this._createElement("<input>").addClass("plate-setup-tab-input").attr("placeholder",e.placeholder||"").attr("id",i);n.root.find(".plate-setup-tab-field-container").append(t),this.defaultWell[i]=null;var a=e.units||[],l=e.defaultUnit||null,s=null;if(l?a.length?a.indexOf(l)<0&&(l=a[0]):a=[l]:a.length&&(l=a[0]),a.length)if(n.units=a,n.hasUnits=!0,n.defaultUnit=l,1==a.length){var r=f("<div></div>").addClass("plate-setup-tab-unit");r.text(l),n.root.find(".plate-setup-tab-field-container").append(r)}else{s=this._createElement("<input/>").attr("id",i).addClass("plate-setup-tab-label-select-field"),n.root.find(".plate-setup-tab-field-container").append(s);var o=null,d={data:a.map(function(e){var t={id:e,text:e};return e==l&&(o=t),t}),allowClear:!1,minimumResultsForSearch:10};s.select2(d),s.select2("data",o)}n.disabled=function(e){n.input.prop("disabled",e),s&&s.prop("disabled",e)},n.setUnitOpts=function(e){n.units=e||null;var t=[],i=n.defaultUnit=null;n.units&&n.units.length&&(n.defaultUnit=n.units[0],t=n.units.map(function(e){var t={id:e,text:e};return e==n.defaultUnit&&(i=t),t}));var a={data:t,allowClear:!1,minimumResultsForSearch:10};s.select2(a),s.select2("data",i)},n.parseValue=function(e){var t;if(f.isPlainObject(e)){if(n.hasUnits)return null===(t=n.parseRegularValue(e.value))?null:{value:t,unit:n.parseUnit(e.unit)};throw"Value must be plain numeric for numeric field "+i}return n.hasUnits?null===(t=n.parseRegularValue(e))?null:{value:t,unit:n.defaultUnit}:n.parseRegularValue(e)},n.getValue=function(){var e=n.getRegularValue();if(null===e||isNaN(e))return null;if(n.hasUnits){var t={value:e,unit:n.getUnit()};if(n.data.hasMultiplexUnit)for(var i in n.data.unitMap){n.data.unitMap[i].forEach(function(e){e.text===t.unit&&(t.unitTypeId=i,t.unitId=e.id)})}return t}return e},n.setValue=function(e){n.hasUnits?f.isPlainObject(e)?(n.setUnit(e.unit||n.defaultUnit),n.setRegularValue(e.value)):(n.setRegularValue(e),n.setUnit(n.defaultUnit)):n.setRegularValue(e)},n.parseRegularValue=function(e){if(null==e)return null;var t=String(e).trim();if(""===t)return null;if(t=Number(e),isNaN(t))throw"Invalid value "+e+" for numeric field "+i;return t},n.getRegularValue=function(){var e=t.val().trim();return e=""==e?null:Number(e)},n.setRegularValue=function(e){t.val(e)},n.parseUnit=function(e){if(null==e||""===e)return n.defaultUnit;for(var t=0;t<a.length;t++)if(e.toLowerCase()==a[t].toLowerCase())return a[t];throw"Invalid unit "+e+" for field "+i},n.getUnit=function(){return s?s.val():n.defaultUnit},n.setUnit=function(e){s&&(null!=(e=e||n.defaultUnit)&&(e={id:e,text:e}),s.select2("data",e))},n.getText=function(e){if("object"==typeof e&&e){var t=e.value,i=e.unit;return null==t?"":(t=t.toString(),i||(i=l),i&&(t=t+" "+i),t)}return n.getRegularText(e)},n.getRegularText=function(e){return null==e?"":e=e.toString()},n.parseText=function(e){var t=n.parseValue(e);return t&&"object"==typeof t?t.value+t.unit:t||null},t.on("input",function(){var e=n.getRegularValue();isNaN(e)?t.addClass("invalid"):t.removeClass("invalid"),n.onChange()}),s&&s.on("change",function(){n.onChange()}),n.input=t,n.unitInput=s},_createBooleanField:function(t){var i=t.id,a=this._createElement("<input/>").attr("id",i).addClass("plate-setup-tab-select-field");this.defaultWell[i]=null,t.root.find(".plate-setup-tab-field-container").append(a);var n={id:"true",text:"true"},l={id:"false",text:"false"},e={data:[n,l],placeholder:"select",allowClear:!0,minimumResultsForSearch:-1,initSelection:function(e,t){var i=e.val();t({id:i,text:i})}};a.select2(e),t.disabled=function(e){t.input.prop("disabled",e)},t.parseValue=function(e){if(null==e)return null;var t=String(e).trim().toLowerCase();if("true"==t)t=!0;else if("false"==t)t=!1;else{if(""!=t)throw"Invalid value "+e+" for boolean field "+i;t=null}return t},t.getValue=function(){switch(a.val()){case"true":return!0;case"false":return!1;default:return null}},t.setValue=function(e){e=1==e||"true"==e?n:0==e||"false"==e?l:null,a.select2("data",e)},t.getText=function(e){return null==e?"":e.toString()},t.parseText=t.parseValue,a.on("change",function(e){t.onChange()}),t.input=a},_createMultiplexField:function(o){var d=this;this._createMultiSelectField(o),d.defaultWell[o.id]=[];var e=d._createElement("<div></div>").addClass("plate-setup-tab-name-singleSelect").text("Select to edit"),t=d._createElement("<div></div>").addClass("plate-setup-tab-field-container-singleSelect");o.root.find(".plate-setup-tab-field-right-side").append(e,t),o.singleSelect=this._createElement("<input/>").attr("id",o.id+"SingleSelect").addClass("plate-setup-tab-multiplex-single-select-field"),o.singleSelect.appendTo(t),o.singleSelectValue=function(){var e=o.singleSelect.select2("data");return null!=e&&(e=e.id),e};var u=function(e,t){var i={allowClear:!1,placeholder:"select",minimumResultsForSearch:10,data:e||[]};t||(t=i.data.length?i.data[0]:null),o.singleSelect.select2("data",{}),o.singleSelect.select2(i),o.singleSelect.select2("data",t),o.singleSelect.prop("disabled",0==i.data.length)},c=function(){var t=o.singleSelectValue();o.updateSubFieldUnitOpts(t);var e=o.detailData||[],i=null;e.forEach(function(e){e[o.id]===t&&(i=e)}),i?o.subFieldList.forEach(function(e){e.disabled(!1),e.setValue(i[e.id])}):o.subFieldList.forEach(function(e){e.disabled(!0),e.setValue(null)}),d.readOnlyHandler()};u([]),o.singleSelect.on("change",c),o._changeMultiFieldValue=function(e,t){var i,a={};for(var n in o.data.multiplexFields){a[o.data.multiplexFields[n].id]=null}e&&(i=e.value?e.value:(a[o.id]=e.id,a),e={id:e.id,value:i}),t&&(i=t.value?t.value:(a[o.id]=t.id,a),t={id:t.id,value:i});var l={};l[o.id]={multi:!0,added:e,removed:t},d._addAllData(l)};var a=o.setValue;o.setValue=function(e){var t=null;(o.detailData=e)&&e.length&&(t=e.map(function(e){return e[o.id]})),a(t);var i=o.input.select2("data")||[];u(i),c()},o.disabled=function(t){o.input.prop("disabled",t),o.subFieldList.forEach(function(e){e.disabled(t)}),t?e.text("Select to inspect"):e.text("Select to edit")},o.parseValue=function(e){var t=e;return t=t&&t.length?t.map(function(t){var i={};for(var a in i[o.id]=t[o.id],t)o.subFieldList.forEach(function(e){e.id===a&&(i[e.id]=e.parseValue(t[a]))});return i}):null},o.updateSubFieldUnitOpts=function(t){var i;o.data.options.forEach(function(e){e.id===t&&(i=e)}),o.subFieldList.forEach(function(e){e.data.hasMultiplexUnit&&(i&&i.hasOwnProperty("unitOptions")?e.setUnitOpts(i.unitOptions[e.id]):e.setUnitOpts(null))})},o.multiOnChange=function(e,t){o._changeMultiFieldValue(e,t);var i=o.getValue(),l=o.detailData,s=[],a=null;l&&(s=l.map(function(e){return e[o.id]}));var r=[],n=[];i&&(i.forEach(function(a){if(l&&l.forEach(function(e){e[o.id]===a&&r.push(e)}),s.indexOf(a)<0){var n={};n[o.id]=a,o.updateSubFieldUnitOpts(a),o.subFieldList.forEach(function(i){if(i.hasUnits)if(i.data.hasMultiplexUnit)i.disabled(!1),o.data.options.forEach(function(e){if(e.id===a){var t={value:null,unit:i.units[0]};n[i.id]=i.parseValue(t)}});else{i.data.units&&1<i.data.units.length&&i.disabled(!1);var e={value:null,unit:i.defaultUnit};n[i.id]=i.parseValue(e)}else n[i.id]=i.parseValue(null)}),r.push(n)}}),i.forEach(function(t){o.data.options.forEach(function(e){e.id===t&&n.push(e)})}),a=n[i.length-1]),o.detailData=r,u(n,a),c()},o.getText=function(e){if(null===e)return"";if(o.id in d.globalSelectedMultiplexSubfield){var i=d.globalSelectedMultiplexSubfield[o.id],t=[];for(var a in e){var n=e[a],l=[];for(var s in o.data.options){var r=o.data.options[s];r.id===n[o.id]&&l.push(r.text)}o.subFieldList.forEach(function(e){if(0<=i.indexOf(e.id)){var t=e.getText(n[e.id]);l.push(e.name+": "+t)}}),t.push("{"+l.join(", ")+"}")}return t.join(";")}},o.parseText=function(e){if(null===e)return"";var t=[];for(var i in e){var a=e[i],n=[];for(var l in o.data.options){var s=o.data.options[l];s.id===a[o.id]&&n.push(s.text)}o.subFieldList.forEach(function(e){var t=e.getText(a[e.id]);t&&n.push(t)}),t.push(n)}return t},o.checkMultiplexCompletion=function(e){var t=0,i=0,s=!1;function a(e){var t=0,i=0;for(var a in o.subFieldList){var n=o.subFieldList[a],l=e[n.id];n.required&&(s=!0,t++,"object"==typeof l&&l?l.value&&i++:l&&i++)}return i/t}if(e)if(0<e.length)for(var n in e){t++,i+=a(e[n])}else o.required&&(s=!0,t=1);else o.required&&(s=!0,t=1);return{include:s,completionPct:i/t}},o.applyMultiplexSubFieldColor=function(e){var l={};o.subFieldList.forEach(function(e){e.required&&(l[e.id]={field:e,warningStatus:[]})}),e.forEach(function(e){!function(e){for(var t in o.subFieldList){var i=o.subFieldList[t];if(null===e)o.required&&i.required&&l[i.id].warningStatus.push(!0);else if("object"==typeof e)if(0===e.length)o.required&&i.required&&l[i.id].warningStatus.push(!0);else for(var a in e){var n=e[a][i.id];i.required&&("object"==typeof n&&n?n.value?l[i.id].warningStatus.push(!1):l[i.id].warningStatus.push(!0):n?l[i.id].warningStatus.push(!1):l[i.id].warningStatus.push(!0))}}}(e)});var t=[];for(var i in l){var a=l[i].field;if(0<=l[i].warningStatus.indexOf(!0)){var n=a.name+" is a required subfield for "+o.name+", please make sure all "+o.name+" have "+a.name;o.required,d.fieldWarningMsg(a,n,!0),t.push(!0)}else d.fieldWarningMsg(a,"none",!1),t.push(!1)}var s,r=!1;r=!(t.indexOf(!0)<0),s=o.required?o.name+" is a required field, please also fix missing required subfield(s) below":o.name+" is not a required field, please fix missing required subfield(s) below or remove selected "+o.name,d.fieldWarningMsg(o,s,r)},o.parseMainFieldVal=function(e){for(var t=o.data.options,i=0;i<t.length;i++){var a=t[i];if(a.id===e)return a.text}}},_deleteDialog:function(t){var e,i=this,a=t.allSelectedMultipleVal;e=a?Object.keys(a):[];var n=f("<div/>").addClass("delete-dialog modal");function l(){n.hide(),n.remove()}f("body").append(n);var s=f("<div/>").addClass("modal-content").appendTo(n),r=f("<div/>").appendTo(s),o=f("<div/>").addClass("dialog-buttons").css("justify-content","flex-end").appendTo(s);if(0<e.length){f("<p/>").text(t.name+" in selected wells: choose items to delete and click the delete button below").appendTo(r);var d=i._deleteDialogTable(t,a);if(d.appendTo(r),d.addClass("plate-popout-table"),d.find("td").addClass("plate-popout-td"),d.find("th").addClass("plate-popout-th"),d.find("tr").addClass("plate-popout-tr"),!i.readOnly){var u=f("<button class='multiple-field-manage-delete-button'>Delete Checked Items</button>");o.append(u),u.click(function(){d.find("input:checked").each(function(){var e=this.value;t.multiOnChange(null,{id:e})}),i.decideSelectedFields(),l()})}}else f("<p/>").text("No "+t.name+" in the selected wells").appendTo(r);var c=f("<button>Cancel</button>");o.append(c),c.click(l),n.show(),window.onclick=function(e){e.target==n[0]&&l()}},_deleteDialogTable:function(e,a){var n=this,t=[e.name,"Counts"];n.readOnly||t.push("Delete");var i=f("<table/>"),l=f("<thead/>").appendTo(i);f("<tr/>").appendTo(l).append(t.map(function(e){return f("<th/>").text(e)}));var s=f("<tbody/>").appendTo(i);return e.data.options.forEach(function(e){if(e.id in a){var t=f("<tr/>").appendTo(s),i=f("<input type='checkbox'>").prop("value",e.id);f("<td/>").text(e.text).appendTo(t),f("<td/>").text(a[e.id]).appendTo(t),n.readOnly||f("<td/>").append(i).appendTo(t)}}),i},_createDeleteButton:function(e){var t=this,i=f("<button/>").addClass("plate-setup-remove-all-button");i.id=e.id+"Delete",i.text("Manage "+e.name+"...");var a=t._createElement("<div></div>").addClass("plate-setup-remove-all-button-container");a.append(i),e.deleteButton=i,e.root.find(".plate-setup-tab-field-right-side").append(a),i.click(function(){t._deleteDialog(e)})}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};!function(b,e){plateLayOutWidget.engine=function(v){return{engine:{derivative:{},stackUpWithColor:{},stackPointer:2,wellEmpty:function(e){for(var t in e){var i=e[t];if(null!=i){if(!Array.isArray(i))return!1;if(0<i.length)return!1}}return!0},searchAndStack:function(){this.stackUpWithColor={},this.stackPointer=1;var e={};for(var t in this.derivative){for(var i=this.derivative[t],a={},n=0;n<v.globalSelectedAttributes.length;n++){var l=v.globalSelectedAttributes[n];if(l in v.globalSelectedMultiplexSubfield){var s=v.globalSelectedMultiplexSubfield[l],r=[];for(var o in i[l]){var d=i[l][o],u={};u[l]=d[l],s.forEach(function(e){u[e]=d[e]}),r.push(u)}a[l]=r}else null!=i[l]&&(a[l]=i[l])}b.isEmptyObject(a)?e[t]=null:e[t]=JSON.stringify(a)}for(;!b.isEmptyObject(e);){var c=Object.keys(e).map(function(e){return parseFloat(e,10)});c.sort(function(e,t){return e-t});var f=c[0],p=e[f],h=[];if(p){for(n=0;n<c.length;n++){p==e[t=c[n]]&&(h.push(t),this.stackUpWithColor[this.stackPointer]=h,delete e[t])}0<h.length&&this.stackPointer++}else this.stackUpWithColor[0]?this.stackUpWithColor[0].push(f):this.stackUpWithColor[0]=[f],delete e[f]}},applyColors:function(){var e=0,t=0;v.addBottomTableHeadings();for(var i=0;i<v.allTiles.length;i++){var a=v.allTiles[i];v.setTileVisible(a,!1)}for(var n=0;n<this.stackPointer;n++){var l=this.stackUpWithColor[n];if(l)for(var s in v.addBottomTableRow(n,l),l){e++;var r=this.stackUpWithColor[n][s],o=(a=v.allTiles[r],this.derivative[r]);v.setTileColor(a,n,this.stackPointer);var d=this.checkCompletion(o,a);v.setTileComplete(a,1==d),t+=d}}t=Math.floor(100*t/e),isNaN(t)?v.overLayTextContainer.text("Completion Percentage: 0%"):v.overLayTextContainer.text("Completion Percentage: "+t+"%")},checkCompletion:function(e,t){for(var i=0,a=0,n=0;n<v.fieldList.length;n++){var l=v.fieldList[n];if(l.checkMultiplexCompletion){var s=l.checkMultiplexCompletion(e[l.id]);s.include&&(a+=s.completionPct,i++)}else l.required&&(i++,null!==e[l.id]&&a++)}return i===a?1:a/i}}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};!function(u,n){plateLayOutWidget.fabricEvents=function(){return{colorToIndex:{},startCoords:{x:0,y:0},focalWell:{row:0,col:0},selectedAreas:[],_clickCoords:function(e){var t=e.e.target.getBoundingClientRect();return{x:e.e.clientX-t.left,y:e.e.clientY-t.top}},_fabricEvents:function(){var s=this;u(s.target).on("getPlates",function(e,t){s.getPlates(JSON.parse(t))}),s.mainFabricCanvas.on("mouse:down",function(e){s.selecting=!0;var t=s._clickCoords(e),i=s.selectedAreas.slice(),a=s.focalWell,n=s._wellToCoords(a,!0),l=s._coordsToRect(n,t);e.e.ctrlKey?(n=t,l=s._coordsToRect(n,t),a=s._coordsToWell(n),e.e.shiftKey?i=[s._rectToArea(l)]:i.push(s._rectToArea(l))):e.e.shiftKey?i[i.length-1]=s._rectToArea(l):(n=t,l=s._coordsToRect(n,t),a=s._coordsToWell(n),i=[s._rectToArea(l)]),s.startCoords=n,s.setSelection(i,a),s.mainFabricCanvas.renderAll()}),s.mainFabricCanvas.on("mouse:move",function(e){if(s.selecting){var t=s.selectedAreas.slice(),i=s._clickCoords(e),a=s._coordsToRect(s.startCoords,i),n=s._rectToArea(a);n&&(t[t.length-1]=n),s.setSelection(t,s.focalWell),s.mainFabricCanvas.renderAll()}}),s.mainFabricCanvas.on("mouse:up",function(e){s.selecting=!1;var t=s.selectedAreas.slice(),i=s._clickCoords(e),a=s._coordsToRect(s.startCoords,i),n=s._rectToArea(a);n&&(t[t.length-1]=n),s.setSelection(t,s.focalWell),s.decideSelectedFields(),s.mainFabricCanvas.renderAll(),s._trigger("selectedWells",null,{selectedAddress:s.getSelectedAddress()})})},setSelection:function(e,t){this.selectedAreas=e,this.focalWell=t,this.allSelectedObjects=this._areasToTiles(e),this._setSelectedTiles(),this._setFocalWellRect(this.focalWell),document.activeElement.blur()},_setFocalWellRect:function(e){var t;if(this.disableAddDeleteWell){var i=this.locToAddress({r:e.row,c:e.col});this.addressAllowToEdit.indexOf(i)<0?(t=!1,this.setFieldsDisabled(!0)):(t=!0,this.setFieldsDisabled(!1))}else e&&(t=!0);if(t){var a=this._areaToRect(this._wellToArea(e));this.focalWellRect?(this.focalWellRect.top=a.top,this.focalWellRect.left=a.left,this.focalWellRect.width=a.width-2,this.focalWellRect.height=a.height-2):(this.focalWellRect=new n.Rect({width:a.width-2,height:a.height-2,left:a.left,top:a.top,fill:null,strokeWidth:2,stroke:"black",selectable:!1}),this.mainFabricCanvas.add(this.focalWellRect))}else this.mainFabricCanvas.remove(this.focalWellRect),this.focalWellRect=null},_setSelectedTiles:function(){var i=this.allSelectedObjects;this.allTiles.forEach(function(e){var t=0<=i.indexOf(e);e.highlight.visible=t})},_getSelectedWells:function(){var i=this;return this.allSelectedObjects.map(function(e){var t=i.engine.derivative[e.index];return t||(t=i.defaultWell),t})},_getCommonFields:function(e){if(e.length){for(var t=e[0],i=u.extend(!0,{},t),a=1;a<e.length;a++){var n=e[a];for(var l in i)if(Array.isArray(i[l])){for(var s=i[l],r=[],o=0;o<s.length;o++){var d=s[o];d&&"object"==typeof d?this.containsObject(d,n[l])&&r.push(d):0<=u.inArray(d,n[l])&&r.push(d)}i[l]=r}else n[l]&&"object"==typeof n[l]&&i[l]&&"object"==typeof i[l]?n[l].value===i[l].value&&n[l].unit===i[l].unit||delete i[l]:i[l]!=n[l]&&delete i[l]}return i}return{}},containsObject:function(n,e){var t=[];return!!e&&(e.forEach(function(i){var a=[];Object.keys(i).forEach(function(e){if(0<=Object.keys(n).indexOf(e)){var t=i[e];"object"==typeof t&&t?n[e]?a.push(t.unit===n[e].unit&&t.value===n[e].value):a.push(!1):a.push(t===n[e])}}),t.push(a.indexOf(!1)<0)}),0<=t.indexOf(!0))},_getCommonWell:function(e){if(e.length){for(var t=e[0],i=u.extend(!0,{},t),a=1;a<e.length;a++){var n=e[a];for(var l in i)if(Array.isArray(i[l])){for(var s=i[l],r=[],o=0;o<s.length;o++){var d=s[o];"object"==typeof s[o]?this.containsObject(d,n[l])&&r.push(d):0<=u.inArray(d,n[l])&&r.push(d)}i[l]=r}else n[l]&&"object"==typeof n[l]&&i[l]&&"object"==typeof i[l]?n[l].value===i[l].value&&n[l].unit===i[l].unit||(i[l]=null):i[l]!=n[l]&&(i[l]=null)}return i}return this.defaultWell},_getAllMultipleVal:function(e){this.multipleFieldList.forEach(function(i){if(e.length){var a={};e.forEach(function(e){var t=i.id;e[t]&&0<e[t].length&&e[t].forEach(function(e){"object"==typeof e?e[t]in a?a[e[t]]++:a[e[t]]=1:e in a?a[e]++:a[e]=1})}),i.allSelectedMultipleVal=a}else i.allSelectedMultipleVal=null})},decideSelectedFields:function(){var e=this._getSelectedWells();this._getAllMultipleVal(e),this.applyFieldWarning(e);var t=this._getCommonWell(e);this._addDataToTabFields(t)},getDifferentWellsVals:function(e){var t=[];for(var i in e)t.push(e[i]);var a={};if(1<t.length){var n=this._getCommonWell(t),l={};for(var s in e[0])l[s]=[];for(var r in t){var o={},d=t[r];for(var u in d){var c=n[u],f=d[u],p=null;if(Array.isArray(f)){p=[];for(var h=0;h<f.length;h++){var v=f[h];v?this.containsObject(v,c)||(p.push(v),this.containsObject(v,l[u])||l[u].push(v)):0<=c.indexOf(v)&&(p.push(v),0<=!l[u].indexOf(v)&&l[u].push(v))}}else f&&"object"==typeof f?c&&"object"==typeof c?f.value!==c.value&&f.unit!==c.unit&&(p=f,this.containsObject(f,l[u])||l[u].push(f)):(p=f,this.containsObject(f,l[u])||l[u].push(f)):f!==c&&(p=f,0<=!l[u].indexOf(f)&&l[u].push(f));o[u]=p}a[r]=o}for(var u in l)if(0===l[u].length)for(var r in a)delete a[r][u];return a}if(e[0]){var b={};for(var u in e[0]){f=e[0][u];Array.isArray(f)?0<f.length&&(b[u]=f):f&&(b[u]=f)}return{0:b}}},getWellSetAddressWithData:function(){var e=[],t=this.engine.derivative;for(var i in t)e.push(this.indexToAddress(i));return e}}}}(jQuery,fabric),(plateLayOutWidget=plateLayOutWidget||{}).assets=function(){return{_assets:{doImg:"&#10003;",dontImg:"&nbsp;&nbsp;&nbsp;",warningImg:"&#9888;"}}};plateLayOutWidget=plateLayOutWidget||{};!function(i,e){plateLayOutWidget.interface=function(){return{_createInterface:function(){var e="<div></div>";this.container=this._createElement(e).addClass("plate-setup-wrapper"),this.topSection=this._createElement(e).addClass("plate-setup-top-section"),this.topLeft=this._createElement(e).addClass("plate-setup-top-left"),this.topRight=this._createElement(e).addClass("plate-setup-top-right"),this.overLayContainer=this._createElement(e).addClass("plate-setup-overlay-container"),this.canvasContainer=this._createElement(e).addClass("plate-setup-canvas-container"),this._createOverLay(),i(this.topLeft).append(this.overLayContainer),this._createCanvas(),i(this.topLeft).append(this.canvasContainer),i(this.topSection).append(this.topLeft),i(this.topSection).append(this.topRight),i(this.container).append(this.topSection),i(this.element).append(this.container),this._initiateFabricCanvas(),this._createTabAtRight(),this._createTabs(),this._placePresetTabs(),this._bottomScreen(),this._canvas(),this.bottomForFirstTime();var t=this;this._setShortcuts(),i(document.body).keyup(function(e){t._handleShortcuts(e)}),this._configureUndoRedoArray()},_createElement:function(e){return i(e)},_setShortcuts:function(){var t=this;window.addEventListener("cut",function(e){document.activeElement==document.body&&(t.copyCriteria(),t.clearCriteria(),e.preventDefault())}),window.addEventListener("copy",function(e){document.activeElement==document.body&&(t.copyCriteria(),e.preventDefault())}),window.addEventListener("paste",function(e){document.activeElement==document.body&&(t.pasteCriteria(),e.preventDefault())})},_handleShortcuts:function(e){document.activeElement===document.body&&(46==e.keyCode?(this.clearCriteria(),e.preventDefault()):(e.ctrlKey||e.metaKey)&&(90==e.keyCode?(e.shiftKey?this.redo():this.undo(),e.preventDefault()):89==e.keyCode&&(this.redo(),e.preventDefault())))}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};!function(t,e){plateLayOutWidget.loadPlate=function(e){return{getPlates:function(e){var t={};for(var i in e.derivative){var a=e.derivative[i];t[i]=this.sanitizeWell(a)}var n=e.checkboxes||[],l=this.sanitizeAreas(e.selectedAreas,e.focalWell),s={derivative:t,checkboxes:n,selectedAreas:l.selectedAreas,focalWell:l.focalWell};this.setData(s)},sanitizeAreas:function(e,t){var i=this,a=this.dimensions.rows,n=this.dimensions.cols;if(e||(e=[]),e.length){var l=(e=e.map(function(e){return{minCol:i._coordIndex(Math.min(e.minCol,e.maxCol),n),minRow:i._coordIndex(Math.min(e.minRow,e.maxRow),a),maxCol:i._coordIndex(Math.max(e.minCol,e.maxCol),n),maxRow:i._coordIndex(Math.max(e.minRow,e.maxRow),a)}}))[e.length-1];t&&!this._wellInArea(t,l)&&(t=null),t||(t={row:l.minRow,col:l.minCol})}else t||(t={row:0,col:0}),e=[this._wellToArea(t)];return{selectedAreas:e,focalWell:t}},sanitizeWell:function(e){for(var t={},i=0;i<this.fieldList.length;i++){var a=this.fieldList[i];t[a.id]=a.parseValue(e[a.id])}return t},setData:function(e){this.engine.derivative=t.extend(!0,{},e.derivative),this.setCheckboxes(e.checkboxes),this.setSelection(e.selectedAreas,e.focalWell),this._colorMixer(),this.decideSelectedFields(),this.mainFabricCanvas.renderAll()}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};jQuery,fabric,plateLayOutWidget.overlay=function(){return{_createOverLay:function(){var t=this;this.overLayTextContainer=this._createElement("<div></div>").addClass("plate-setup-overlay-text-container"),this.overLayTextContainer.text("Completion Percentage:"),this.overLayContainer.append(this.overLayTextContainer),this.overLayButtonContainer=this._createElement("<div></div>").addClass("plate-setup-overlay-button-container"),this.overLayContainer.append(this.overLayButtonContainer),this.clearCriteriaButton=this._createElement("<button />").addClass("plate-setup-button"),this.clearCriteriaButton.text("Clear"),this.overLayButtonContainer.append(this.clearCriteriaButton),this.clearCriteriaButton.click(function(e){t.clearCriteria()}),this.copyCriteriaButton=this._createElement("<button />").addClass("plate-setup-button"),this.copyCriteriaButton.text("Copy"),this.overLayButtonContainer.append(this.copyCriteriaButton),this.copyCriteriaButton.click(function(e){t.copyCriteria()}),this.pasteCriteriaButton=this._createElement("<button />").addClass("plate-setup-button"),this.pasteCriteriaButton.text("Paste"),this.overLayButtonContainer.append(this.pasteCriteriaButton),this.pasteCriteriaButton.click(function(e){t.pasteCriteria()}),this.undoButton=this._createElement("<button />").addClass("plate-setup-button"),this.undoButton.text("Undo"),this.overLayButtonContainer.append(this.undoButton),this.undoButton.click(function(e){t.undo()}),this.redoButton=this._createElement("<button />").addClass("plate-setup-button"),this.redoButton.text("Redo"),this.overLayButtonContainer.append(this.redoButton),this.redoButton.click(function(e){t.redo()})},clearCriteria:function(){if(this.allSelectedObjects){for(var e=this.allSelectedObjects.length,t=!1,i=0;i<e;i++){var a=this.allSelectedObjects[i];if(a.index in this.engine.derivative){if(this.emptyWellWithDefaultVal&&this.disableAddDeleteWell){var n=JSON.parse(JSON.stringify(this.defaultWell)),l=this.emptyWellWithDefaultVal;for(var s in l)s in n?(n[s]=l[s],this._applyFieldData(s,l[s])):console.log("Well does not contain key: "+s+", please contact support");this.engine.derivative[a.index]=n}else delete this.engine.derivative[a.index];t=!0}}t&&this.derivativeChange(),this._colorMixer(),this.decideSelectedFields()}else alert("Please select any well")},copyCriteria:function(){if(this.allSelectedObjects){var e=this._getSelectedWells();this.commonWell=this._getCommonFields(e)}else alert("Please select any well.")},pasteCriteria:function(){this.commonWell&&(this._addAllData(this.commonWell),this.decideSelectedFields(),this.mainFabricCanvas.renderAll())}}},$.widget("DNA.plateLayOut",{plateLayOutWidget:{},options:{value:0},allTiles:[],addressToLoc:function(e){var t=/^([A-Z]+)(\d+)$/.exec(e.trim().toUpperCase());if(t){for(var i,a=t[1],n=parseInt(t[2])-1,l=0;l<a.length;l++){var s=a.charCodeAt(l)-65;l?(i+=1,i*=26,i+=s):i=s}return{r:i,c:n}}throw e+" not a proper layout address"},locToIndex:function(e,i){if(i||(i=this.dimensions),e.r<0&&t,!(0<=e.r&&e.r<i.rows))throw"Row index "+(e.r+1)+" invalid";if(!(0<=e.c&&e.c<i.cols))throw"Column index "+(e.c+1)+" invalid";return e.r*i.cols+e.c},addressToIndex:function(e,t){var i=this.addressToLoc(e);return this.locToIndex(i,t)},_rowKey:function(e){var t=e%26,i=(e-t)/26,a=String.fromCharCode(65+t);return 0<i&&(a=String.fromCharCode(64+i)+a),a},indexToLoc:function(e,t){if(t||(t=this.dimensions),e>=t.rows*t.cols)throw"Index too high: "+e.toString(10);var i={};return i.c=e%t.cols,i.r=(e-i.c)/t.cols,i},locToAddress:function(e){return this._rowKey(e.r)+(e.c+1).toString(10)},indexToAddress:function(e,t){var i=this.indexToLoc(e,t);return this.locToAddress(i)},getDimensions:function(){return $.extend(!0,{},this.dimensions)},_create:function(){var e=parseInt(this.options.numRows||8),t=parseInt(this.options.numCols||12);this.dimensions={rows:e,cols:t},this.rowIndex=[];for(var i=0;i<e;i++)this.rowIndex.push(this._rowKey(i));for(var a in this.target=this.element[0].id?"#"+this.element[0].id:"."+this.element[0].className,this.options.readOnly&&this.isReadOnly(!0),plateLayOutWidget)$.extend(this,new plateLayOutWidget[a](this));return this.imgSrc=this.options.imgSrc||"assets",this._createInterface(),this._trigger("created",null,this),this},_init:function(){},addData:function(){alert("wow this is good")},getTextDerivative:function(e){var t={};this.fieldMap;for(var i in e){var a={},n={},l=e[i];for(var s in l)if(s in this.fieldMap){var r=this.fieldMap[s],o=r.parseText(l[s]);n[r.name]=o,a[s]=o}else n[s]=l[s],a[s]=l[s];t[i]={textVal:a,textFieldVal:n}}return t},getWellsDifferences:function(e){return this.getDifferentWellsVals(e)},setFieldsDisabled:function(t){this.fieldList.forEach(function(e){e.disabled(t)})},isReadOnly:function(e){this.readOnly=!!e,this.readOnlyHandler()},readOnlyHandler:function(){this.readOnly?(this.overLayButtonContainer.css("display","none"),$(".multiple-field-manage-delete-button").css("display","none"),this.setFieldsDisabled(!0)):(this.overLayButtonContainer.css("display","flex"),$(".multiple-field-manage-delete-button").css("display","none"),this.disableAddDeleteWell||this.setFieldsDisabled(!1))},disableAddDeleteWell:null,isDisableAddDeleteWell:function(e,t){e?(this.disableAddDeleteWell=!0,this.addressAllowToEdit=this.getWellSetAddressWithData(),this.actionPointer=0,this.undoRedoArray=[],this.undoRedoArray.push(this.createObject()),t&&(this.emptyWellWithDefaultVal=t)):(this.disableAddDeleteWell=!1,this.setFieldsDisabled(!1),this.emptyWellWithDefaultVal=null),this._fabricEvents()},getSelectedObject:function(){for(var e=[],t=0;t<this.allSelectedObjects.length;t++)e.push(this.allSelectedObjects[t].address);var i={},a=this.engine.derivative;for(var n in a){var l=this.indexToAddress(n);0<=e.indexOf(l)&&(i[l]=a[n])}return i},getSelectedIndex:function(){return this.allSelectedObjects.map(function(e){return that.addressToIndex(e.address)})},getSelectedAddress:function(){return this.allSelectedObjects.map(function(e){return e.address})},setSelectedWell:function(e){for(var t=[],i=999,a={},n=0;n<e.length;n++){var l=this.addressToIndex(e[n]),s=this.indexToLoc(l);t.push({minCol:s.c,minRow:s.r,maxCol:s.c,maxRow:s.r}),s.r<=i&&(i=s.r,s.r in a?a[s.r].push(s.c):a[s.r]=[s.c])}var r={row:i,col:Math.min.apply(null,a[i])};this.setSelection(t,r),this.decideSelectedFields(),this.mainFabricCanvas.renderAll()}}),window.onload=function(){var e={presets:[{title:"Pol/Vol",fields:["volume","pol"]},{title:"Vol",fields:["volume"]}],tabs:[{name:"Settings",fields:{polymerase:{required:!0,id:"pol",name:"Polymerase",type:"multiselect",placeHolder:"Polymerase",options:[{id:234,text:"Taq 1, processive enzyme with long name"},{id:123,text:"Taq 2"},{id:3,text:"Taq 3"},{id:4,text:"Taq 4"},{id:5,text:"Taq 5"}]},volume:{required:!0,id:"volume",name:"Volume",type:"numeric",placeholder:"Volume",units:["uL","mL"],defaultUnit:"uL"},conc:{required:!0,id:"conc",name:"Concentration",type:"numeric",placeholder:"Conc.",defaultUnit:"ng/ul (final)"},on_ice:{required:!0,id:"on_ice",name:"On Ice",type:"boolean",placeHolder:"On Ice"}}}]};window.plateData={},$("#my-plate-layout").plateLayOut({numRows:8,numCols:12,imgSrc:"app/assets/images/plate-map",attributes:e,updateWells:function(e,t){window.plateData=t,console.log(Object.keys(t.derivative).length+" wells updated")},created:function(e,t){console.log("Created")}}),window.plateData=function(e){for(var t=$("#my-plate-layout").plateLayOut("getDimensions"),i=t.rows,a=t.cols,n={},l=0;l<i;l++)for(var s=100,r=l<i/2?234:123,o=Boolean(l%2),d=0;d<a;d++){var u=s;u<1&&(u*=1e3),n[(l*a+d).toString()]={volume:u,pol:r,amplicons:[{amplicons:"A",template_ngul:"a",primer_umolarity:2,probe_umolarity:3,dilution_factor:4},{amplicons:"B",template_ngul:"b",primer_umolarity:22,probe_umolarity:33,dilution_factor:44}],on_ice:o},0<d%2&&(s/=10)}return{derivative:n,checkboxes:["volume","pol"]}}(),$("#my-plate-layout").plateLayOut("getPlates",window.plateData)};plateLayOutWidget=plateLayOutWidget||{};!function(s,e){plateLayOutWidget.preset=function(e){return{presets:[],_placePresetTabs:function(){var e=this.options.attributes.presets;if(e&&e.length){this.wellAttrContainer=this._createElement("<div></div>").addClass("plate-setup-well-attr-container").text("Checkbox presets"),this.tabContainer.append(this.wellAttrContainer),this.presetTabContainer=this._createElement("<div></div>").addClass("plate-setup-preset-container"),this.tabContainer.append(this.presetTabContainer);for(var t=0;t<e.length;t++){var i=e[t],a=this._createElement("<div></div>").addClass("plate-setup-prest-tab-div").text(i.title),n=this._createElement("<div></div>").addClass("plate-setup-prest-tab").data("preset",i.fields).append(a);this.presetTabContainer.append(n);var l=this;n.click(function(){var e=s(this);l._selectPreset(e)}),this.presets.push(n)}}},_clearPresetSelection:function(){for(var e=0;e<this.presets.length;e++){this.presets[e].removeClass("plate-setup-prest-tab-selected").addClass("plate-setup-prest-tab")}},_selectPreset:function(e){this.setCheckboxes(e.data("preset")),e.removeClass("plate-setup-prest-tab").addClass("plate-setup-prest-tab-selected")}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};!function(a,e){plateLayOutWidget.tabs=function(){return{allTabs:[],defaultWell:{},allDataTabs:[],_createTabAtRight:function(){this.tabContainer=this._createElement("<div></div>").addClass("plate-setup-tab-container"),a(this.topRight).append(this.tabContainer)},_createTabs:function(){this.tabHead=this._createElement("<div></div>").addClass("plate-setup-tab-head"),a(this.tabContainer).append(this.tabHead);var e=this.options.attributes.tabs,i=this;e.forEach(function(e,t){i.allTabs[t]=i._createElement("<div></div>").addClass("plate-setup-tab"),a(i.allTabs[t]).data("index",t).text(e.name),a(i.allTabs[t]).click(function(){i._tabClickHandler(this)}),a(i.tabHead).append(i.allTabs[t])}),this.tabDataContainer=this._createElement("<div></div>").addClass("plate-setup-tab-data-container"),a(this.tabContainer).append(this.tabDataContainer),this._addDataTabs(e),a(this.allTabs[0]).click(),this._addTabData()},_tabClickHandler:function(e){if(this.selectedTab){a(this.selectedTab).removeClass("plate-setup-tab-selected").addClass("plate-setup-tab");var t=a(this.selectedTab).data("index");a(this.allDataTabs[t]).css("z-index",0),this.readOnlyHandler()}a(e).addClass("plate-setup-tab-selected"),this.selectedTab=e;var i=a(e).data("index");a(this.allDataTabs[i]).css("z-index",1e3)},_addDataTabs:function(e){var t=0;for(var i in e)this.allDataTabs[t++]=this._createElement("<div></div>").addClass("plate-setup-data-div").css("z-index",0),a(this.tabDataContainer).append(this.allDataTabs[t-1])}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};!function(i,e){plateLayOutWidget.undoRedoManager=function(e){return{undoRedoArray:[],actionPointer:null,addToUndoRedo:function(e){if(null!=this.actionPointer){var t=this.actionPointer+1;t<this.undoRedoArray.length&&this.undoRedoArray.splice(t,this.undoRedoArray.length-t)}this.actionPointer=null,this.undoRedoArray.push(i.extend(!0,{},e))},_configureUndoRedoArray:function(){this.undoRedoArray=[],this.actionPointer=null,this.undoRedoArray.push(i.extend({},{checkboxes:[],derivative:{},selectedAreas:[{minRow:0,minCol:0,maxRow:0,maxCol:0}],focalWell:{row:0,col:0}}))},undo:function(){return console.log("undo"),this.shiftUndoRedo(-1)},redo:function(){return console.log("redo"),this.shiftUndoRedo(1)},shiftUndoRedo:function(e){var t=this.actionPointer;return null==t&&(t=this.undoRedoArray.length-1),t+=e,this.setUndoRedo(t)},setUndoRedo:function(e){return!(e<0)&&(!(e>=this.undoRedoArray.length)&&(this.undoRedoActive=!0,this.setData(this.undoRedoArray[e]),this.actionPointer=e,this.undoRedoActive=!1,this.derivativeChange(),!0))}}}}(jQuery,fabric);plateLayOutWidget=plateLayOutWidget||{};jQuery,fabric,plateLayOutWidget.wellArea=function(e){return{_areasToTiles:function(e){var l=this.dimensions.cols,s=this;return e.reduce(function(e,t){if(t)for(var i=t.minRow;i<=t.maxRow;i++)for(var a=t.minCol;a<=t.maxCol;a++){var n=s.allTiles[a+l*i];e.indexOf(n)<0&&(s.disableAddDeleteWell?0<=s.addressAllowToEdit.indexOf(n.address)&&e.push(n):e.push(n))}return e},[])},_encodeArea:function(e){return e.minRow==e.maxRow&&e.minCol==e.maxCol?this.rowIndex[e.minRow]+e.minCol.toString(10):this.rowIndex[e.minRow]+e.minCol.toString(10)+":"+this.rowIndex[e.maxRow]+e.maxCol.toString(10)},_encodeAreas:function(e){var t=this;return e.map(function(e){return t._encodeArea(e)}).join(",")},_decodeWell:function(e){var t,i=new RegExp("^\\s*("+this.rowIndex.join("|")+")(\\d+)\\s*$");if(t=e.match(i)){var a=this.rowIndex.indexOf(t[1]);if(0<=a)return{row:a,col:parseInt(t[2])-1}}if(t=e.match(/^\s*R(\d+)C(\d+)\s*$/i))return{row:parseInt(t[1])-1,col:parseInt(t[2])-1};throw"Invalid well address: "+e},_decodeArea:function(e){var t=this,i=e.split(":").map(function(e){return t._decodeWell(e)});if(1==i.length)return{minRow:i[0].row,minCol:i[0].col,maxRow:i[0].row,maxCol:i[0].col};if(2!=i.length)throw"Invalid address: "+e;return Math.min(i[0].row,i[1].row),{minRow:Math.min(i[0].row,i[1].row),minCol:Math.min(i[0].col,i[1].col),maxRow:Math.max(i[0].row,i[1].row),maxCol:Math.max(i[0].col,i[1].col)}},_decodeAreas:function(e){var t=this;return e.split(",").map(function(e){return t._decodeArea(e)})},_wellToArea:function(e){return{minCol:e.col,minRow:e.row,maxCol:e.col,maxRow:e.row}},_wellInArea:function(e,t){return e.row>=t.minRow&&e.row<=t.maxRow&&e.col>=t.minCol&&e.col<=t.maxCol},_coordsToRect:function(e,t){var i=Math.min(e.x,t.x);return{top:Math.min(e.y,t.y),left:i,height:Math.abs(t.y-e.y),width:Math.abs(t.x-e.x)}},_coordIndex:function(e,t){return e<0?0:t<=e?t-1:Math.floor(e)},_coordsToWell:function(e){var t=this.dimensions.cols,i=this.dimensions.rows,a=this.sizes.spacing,n=this.sizes.label_spacing,l=(e.x-n)/a,s=(e.y-n)/a;return{row:this._coordIndex(s,i),col:this._coordIndex(l,t)}},_wellToCoords:function(e,t){var i=this.sizes.spacing,a=this.sizes.label_spacing,n=e.col*i+a,l=e.row*i+a;if(t){var s=i/2;n+=s,l+=s}return{x:n,y:l}},_areaToRect:function(e){var t=e.maxRow-e.minRow+1,i=e.maxCol-e.minCol+1,a=this.sizes.spacing,n=this.sizes.label_spacing;return{top:e.minRow*a+n,left:e.minCol*a+n,height:t*a,width:i*a}},_rectToArea:function(e){var t=this.dimensions.rows,i=this.dimensions.cols,a=this.sizes.spacing,n=this.sizes.label_spacing,l=(e.left-n)/a,s=(e.top-n)/a,r=e.height/a,o=l+e.width/a,d=s+r;return o<0&&(o=i),i<=l&&(l=0),d<0&&(d=t),s<=0&&(s=0),{minCol:this._coordIndex(l,i),minRow:this._coordIndex(s,t),maxCol:this._coordIndex(o,i),maxRow:this._coordIndex(d,t)}}}};