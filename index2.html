<!DOCTYPE html>
<html>
<head>
	<title>Plate-Map Test</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.3/require.min.js"></script>

<script type="text/javascript">
require.config({
  "baseUrl": "app/assets/javascripts"
}); 

require(["plate-layout"], function () {
	var fields = {
        Volume: {
          required: true,
          id:       'volume',
          name:     'Volume',
          type:     'numeric',
          placeholder: "Volume",
          units: {
            1: "uL",
            2: "mL"
          }
        },
        Polymerase: {
          required: true,
          id: 'pol',
          name: 'Polymerase',
          type: 'multiselect',
          placeHolder: "Polymerase",
          options: {
              'Taq 1':  {
                    id:   '234',
                    name: 'Taq 1'
                },
              'Taq 2':  {
                    id:   '123',
                    name: 'Taq 2'
                },
                'Taq 3':  {
                    id:   '3',
                    name: 'Taq 3'
                },
                'Taq 4':  {
                    id:   '4',
                    name: 'Taq 4'
                },
                'Taq 5':  {
                    id:   '5',
                    name: 'Taq 5'
                }
          }
        }
    }; 

	var attributes = {
		presets: {
			"preset 1": ['volume', 'pol'],
			"preset 2": ["volume"]
		},
		tabs: {
			"Settings": {
				fields: fields 
			}
		}, 
	}; //attributes

	window.plateData = {}; 

	function makeNewPlate(obj) {
		var rows = obj.numRows; 
		var cols = obj.numCols; 
		var wells = {}; 
		for (var r = 0; r < rows; r++) {
			var volume = 100; 
			var pol = (r < (rows/2)) ? 'Taq 1' : 'Taq 2'; 
			for (var c = 0; c < cols; c++) {
				var i = r*cols + c; 
				wells[i.toString()] = {
					units: {
						volumeunit:'unit1',
					},
					wellData: {
						volume: volume.toString(),
						pol: pol
					}
				}; 
				if ((c % 2) > 0) {
					volume /= 10
				}
			}
		}
		return {
			derivative: wells, 
			checkboxes: {volume:true, pol: true}, 
		}; 
	}

	$("#my-plate-layout").plateLayOut({
		numRows: 8,
		numCols: 12,
		attributes: attributes,

		updateWells: function(event, data) {
			//this function should save the provided wells to the server
			//and call either updateWellsSuccessful() or updateWellsFailed()
			//on completion
			window.plateData = data; 
			console.log(Object.keys(data.derivative).length + " wells updated"); 
		}
	});
	window.plateData = makeNewPlate($("#my-plate-layout").data().DNAPlateLayOut); 
	$("#my-plate-layout").plateLayOut("getPlates", window.plateData);
}); 
</script>
</head>

<body>
    <h1>Plate-Map Test</h1>
    <hr>
    <div>
      <div id="my-plate-layout">Loading plate layout ... !</div>
    </div>
</body>
</html>